<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 7 Get the data - Dataset 2 | Differential Expression Tutorial</title>
  <meta name="description" content="Chapter 7 Get the data - Dataset 2 | Differential Expression Tutorial" />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 7 Get the data - Dataset 2 | Differential Expression Tutorial" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 7 Get the data - Dataset 2 | Differential Expression Tutorial" />
  
  
  

<meta name="author" content="BCB420 / Ruth Isserlin" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="deseq2.html"/>
<link rel="next" href="qc_dataset2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">BCB420 Lecture </a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#packages"><i class="fa fa-check"></i><b>1.1</b> Packages</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#reproducibility"><i class="fa fa-check"></i><b>1.2</b> Reproducibility</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="get-data.html"><a href="get-data.html"><i class="fa fa-check"></i><b>2</b> Get the data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="get-data.html"><a href="get-data.html#download-the-geo-supplementary-files"><i class="fa fa-check"></i><b>2.1</b> Download the GEO supplementary file(s)</a></li>
<li class="chapter" data-level="2.2" data-path="get-data.html"><a href="get-data.html#read-the-featurecounts-matrix"><i class="fa fa-check"></i><b>2.2</b> Read the FeatureCounts matrix</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="get-data.html"><a href="get-data.html#build-a-counts-matrix-genes-samples"><i class="fa fa-check"></i><b>2.2.1</b> Build a counts matrix (genes × samples)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="get-data.html"><a href="get-data.html#create-metadata-from-sample-names"><i class="fa fa-check"></i><b>2.3</b> Create metadata from sample names</a></li>
<li class="chapter" data-level="2.4" data-path="get-data.html"><a href="get-data.html#identifier-mapping"><i class="fa fa-check"></i><b>2.4</b> Identifier mapping</a></li>
<li class="chapter" data-level="2.5" data-path="get-data.html"><a href="get-data.html#save-intermediate-objects"><i class="fa fa-check"></i><b>2.5</b> Save intermediate objects</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="qc.html"><a href="qc.html"><i class="fa fa-check"></i><b>3</b> QC, filtering and identifier mapping</a>
<ul>
<li class="chapter" data-level="3.1" data-path="qc.html"><a href="qc.html#filter-lowly-expressed-genes"><i class="fa fa-check"></i><b>3.1</b> Filter lowly expressed genes</a></li>
<li class="chapter" data-level="3.2" data-path="qc.html"><a href="qc.html#tmm-normalization"><i class="fa fa-check"></i><b>3.2</b> TMM normalization</a></li>
<li class="chapter" data-level="3.3" data-path="qc.html"><a href="qc.html#exploratory-mds-plot"><i class="fa fa-check"></i><b>3.3</b> Exploratory MDS plot</a></li>
<li class="chapter" data-level="3.4" data-path="qc.html"><a href="qc.html#exploratory-mds-plot---coloured-by-cellline"><i class="fa fa-check"></i><b>3.4</b> Exploratory MDS plot - coloured by cellline</a></li>
<li class="chapter" data-level="3.5" data-path="qc.html"><a href="qc.html#log-cpm-for-visualization"><i class="fa fa-check"></i><b>3.5</b> log-CPM for visualization</a></li>
<li class="chapter" data-level="3.6" data-path="qc.html"><a href="qc.html#save-for-downstream-chapters"><i class="fa fa-check"></i><b>3.6</b> Save for downstream chapters</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="limma-voom.html"><a href="limma-voom.html"><i class="fa fa-check"></i><b>4</b> Differential expression with limma-voom</a>
<ul>
<li class="chapter" data-level="4.1" data-path="limma-voom.html"><a href="limma-voom.html#results-tables"><i class="fa fa-check"></i><b>4.1</b> Results tables</a></li>
<li class="chapter" data-level="4.2" data-path="limma-voom.html"><a href="limma-voom.html#volcano-plot-20ctg-vs-nt"><i class="fa fa-check"></i><b>4.2</b> Volcano plot (20CTG vs NT)</a></li>
<li class="chapter" data-level="4.3" data-path="limma-voom.html"><a href="limma-voom.html#save-limma-results"><i class="fa fa-check"></i><b>4.3</b> Save limma results</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="edger.html"><a href="edger.html"><i class="fa fa-check"></i><b>5</b> Differential expression with edgeR (QLF)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="edger.html"><a href="edger.html#plot-biological-coefficient-of-variance-plot"><i class="fa fa-check"></i><b>5.1</b> Plot Biological coefficient of variance plot</a></li>
<li class="chapter" data-level="5.2" data-path="edger.html"><a href="edger.html#test-3ctg-vs-nt-and-20ctg-vs-nt"><i class="fa fa-check"></i><b>5.2</b> Test: 3CTG vs NT and 20CTG vs NT</a></li>
<li class="chapter" data-level="5.3" data-path="edger.html"><a href="edger.html#test-20ctg-vs-3ctg"><i class="fa fa-check"></i><b>5.3</b> Test: 20CTG vs 3CTG</a></li>
<li class="chapter" data-level="5.4" data-path="edger.html"><a href="edger.html#extract-full-results"><i class="fa fa-check"></i><b>5.4</b> Extract full results</a></li>
<li class="chapter" data-level="5.5" data-path="edger.html"><a href="edger.html#volcano-plot-of-edger-results"><i class="fa fa-check"></i><b>5.5</b> Volcano plot of EdgeR results</a></li>
<li class="chapter" data-level="5.6" data-path="edger.html"><a href="edger.html#visualize-the-top-hits-as-a-heatmap"><i class="fa fa-check"></i><b>5.6</b> Visualize the top hits as a heatmap</a></li>
<li class="chapter" data-level="5.7" data-path="edger.html"><a href="edger.html#select-top-hits-from-tab_20_vs_nt_annot"><i class="fa fa-check"></i><b>5.7</b> Select top hits from <code>tab_20_vs_nt_annot</code></a>
<ul>
<li class="chapter" data-level="5.7.1" data-path="edger.html"><a href="edger.html#top-n-genes-by-fdr"><i class="fa fa-check"></i><b>5.7.1</b> top N genes by FDR</a></li>
</ul></li>
<li class="chapter" data-level="5.8" data-path="edger.html"><a href="edger.html#make-the-expression-matrix-for-the-heatmap-logcpm-row-z-score"><i class="fa fa-check"></i><b>5.8</b> Make the expression matrix for the heatmap (logCPM + row z-score)</a></li>
<li class="chapter" data-level="5.9" data-path="edger.html"><a href="edger.html#sample-annotation-treatment-cellline-using-set3"><i class="fa fa-check"></i><b>5.9</b> Sample annotation (treatment + cellline) using Set3</a></li>
<li class="chapter" data-level="5.10" data-path="edger.html"><a href="edger.html#draw-the-complexheatmap-heatmap"><i class="fa fa-check"></i><b>5.10</b> 5) Draw the ComplexHeatmap heatmap</a></li>
<li class="chapter" data-level="5.11" data-path="edger.html"><a href="edger.html#save-edger-results"><i class="fa fa-check"></i><b>5.11</b> Save edgeR results</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="deseq2.html"><a href="deseq2.html"><i class="fa fa-check"></i><b>6</b> Differential expression with DESeq2</a>
<ul>
<li class="chapter" data-level="6.1" data-path="deseq2.html"><a href="deseq2.html#results"><i class="fa fa-check"></i><b>6.1</b> Results</a></li>
<li class="chapter" data-level="6.2" data-path="deseq2.html"><a href="deseq2.html#volcano-redup-bluedown"><i class="fa fa-check"></i><b>6.2</b> Volcano (red=up, blue=down)</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="get-data_dataset2.html"><a href="get-data_dataset2.html"><i class="fa fa-check"></i><b>7</b> Get the data - Dataset 2</a>
<ul>
<li class="chapter" data-level="7.1" data-path="get-data_dataset2.html"><a href="get-data_dataset2.html#download-the-geo-supplementary-files-1"><i class="fa fa-check"></i><b>7.1</b> Download the GEO supplementary file(s)</a></li>
<li class="chapter" data-level="7.2" data-path="get-data_dataset2.html"><a href="get-data_dataset2.html#read-the-featurecounts-matrix-1"><i class="fa fa-check"></i><b>7.2</b> Read the FeatureCounts matrix</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="get-data_dataset2.html"><a href="get-data_dataset2.html#build-a-counts-matrix-genes-samples-1"><i class="fa fa-check"></i><b>7.2.1</b> Build a counts matrix (genes × samples)</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="get-data_dataset2.html"><a href="get-data_dataset2.html#create-metadata-from-sample-names-1"><i class="fa fa-check"></i><b>7.3</b> Create metadata from sample names</a></li>
<li class="chapter" data-level="7.4" data-path="get-data_dataset2.html"><a href="get-data_dataset2.html#identifier-mapping-1"><i class="fa fa-check"></i><b>7.4</b> Identifier mapping</a></li>
<li class="chapter" data-level="7.5" data-path="get-data_dataset2.html"><a href="get-data_dataset2.html#save-intermediate-objects-1"><i class="fa fa-check"></i><b>7.5</b> Save intermediate objects</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="qc_dataset2.html"><a href="qc_dataset2.html"><i class="fa fa-check"></i><b>8</b> QC, filtering and identifier mapping - Dataset 2</a>
<ul>
<li class="chapter" data-level="8.1" data-path="qc_dataset2.html"><a href="qc_dataset2.html#load-in-the-data"><i class="fa fa-check"></i><b>8.1</b> Load in the data</a></li>
<li class="chapter" data-level="8.2" data-path="qc_dataset2.html"><a href="qc_dataset2.html#simplify-this-model"><i class="fa fa-check"></i><b>8.2</b> Simplify this model</a></li>
<li class="chapter" data-level="8.3" data-path="qc_dataset2.html"><a href="qc_dataset2.html#filter-lowly-expressed-genes-1"><i class="fa fa-check"></i><b>8.3</b> Filter lowly expressed genes</a></li>
<li class="chapter" data-level="8.4" data-path="qc_dataset2.html"><a href="qc_dataset2.html#tmm-normalization-1"><i class="fa fa-check"></i><b>8.4</b> TMM normalization</a></li>
<li class="chapter" data-level="8.5" data-path="qc_dataset2.html"><a href="qc_dataset2.html#exploratory-mds-plot-1"><i class="fa fa-check"></i><b>8.5</b> Exploratory MDS plot</a></li>
<li class="chapter" data-level="8.6" data-path="qc_dataset2.html"><a href="qc_dataset2.html#exploratory-mds-plot---coloured-by-patient"><i class="fa fa-check"></i><b>8.6</b> Exploratory MDS plot - coloured by patient</a></li>
<li class="chapter" data-level="8.7" data-path="qc_dataset2.html"><a href="qc_dataset2.html#log-cpm-for-visualization-1"><i class="fa fa-check"></i><b>8.7</b> log-CPM for visualization</a></li>
<li class="chapter" data-level="8.8" data-path="qc_dataset2.html"><a href="qc_dataset2.html#save-for-downstream-chapters-1"><i class="fa fa-check"></i><b>8.8</b> Save for downstream chapters</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="limma-voom_dataset2.html"><a href="limma-voom_dataset2.html"><i class="fa fa-check"></i><b>9</b> Differential expression with limma-voom - Dataset 2</a>
<ul>
<li class="chapter" data-level="9.1" data-path="limma-voom_dataset2.html"><a href="limma-voom_dataset2.html#results-tables-1"><i class="fa fa-check"></i><b>9.1</b> Results tables</a></li>
<li class="chapter" data-level="9.2" data-path="limma-voom_dataset2.html"><a href="limma-voom_dataset2.html#volcano-plot-0-vs-rest"><i class="fa fa-check"></i><b>9.2</b> Volcano plot (0 vs rest)</a></li>
<li class="chapter" data-level="9.3" data-path="limma-voom_dataset2.html"><a href="limma-voom_dataset2.html#save-limma-results-1"><i class="fa fa-check"></i><b>9.3</b> Save limma results</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="edger_dataset2.html"><a href="edger_dataset2.html"><i class="fa fa-check"></i><b>10</b> Differential expression with edgeR (QLF) - Dataset 2</a>
<ul>
<li class="chapter" data-level="10.1" data-path="edger_dataset2.html"><a href="edger_dataset2.html#plot-biological-coefficient-of-variance-plot-1"><i class="fa fa-check"></i><b>10.1</b> Plot Biological coefficient of variance plot</a></li>
<li class="chapter" data-level="10.2" data-path="edger_dataset2.html"><a href="edger_dataset2.html#test-status-0-vs-status-1"><i class="fa fa-check"></i><b>10.2</b> Test: status 0 vs status 1</a></li>
<li class="chapter" data-level="10.3" data-path="edger_dataset2.html"><a href="edger_dataset2.html#extract-full-results-1"><i class="fa fa-check"></i><b>10.3</b> Extract full results</a></li>
<li class="chapter" data-level="10.4" data-path="edger_dataset2.html"><a href="edger_dataset2.html#volcano-plot-of-edger-results-1"><i class="fa fa-check"></i><b>10.4</b> Volcano plot of EdgeR results</a></li>
<li class="chapter" data-level="10.5" data-path="edger_dataset2.html"><a href="edger_dataset2.html#try-and-run-glmfit"><i class="fa fa-check"></i><b>10.5</b> Try and run glmFit</a></li>
<li class="chapter" data-level="10.6" data-path="edger_dataset2.html"><a href="edger_dataset2.html#test-status-0-vs-status-1-1"><i class="fa fa-check"></i><b>10.6</b> Test: status 0 vs status 1</a></li>
<li class="chapter" data-level="10.7" data-path="edger_dataset2.html"><a href="edger_dataset2.html#save-edger-results-1"><i class="fa fa-check"></i><b>10.7</b> Save edgeR results</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="deseq2_dataset2.html"><a href="deseq2_dataset2.html"><i class="fa fa-check"></i><b>11</b> Differential expression with DESeq2 - Dataset 2</a>
<ul>
<li class="chapter" data-level="11.1" data-path="deseq2_dataset2.html"><a href="deseq2_dataset2.html#results-1"><i class="fa fa-check"></i><b>11.1</b> Results</a></li>
<li class="chapter" data-level="11.2" data-path="deseq2_dataset2.html"><a href="deseq2_dataset2.html#volcano-redup-bluedown-1"><i class="fa fa-check"></i><b>11.2</b> Volcano (red=up, blue=down)</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Differential Expression Tutorial</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="get-data_dataset2" class="section level1 hasAnchor" number="7">
<h1><span class="header-section-number">Chapter 7</span> Get the data - Dataset 2<a href="get-data_dataset2.html#get-data_dataset2" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="download-the-geo-supplementary-files-1" class="section level2 hasAnchor" number="7.1">
<h2><span class="header-section-number">7.1</span> Download the GEO supplementary file(s)<a href="get-data_dataset2.html#download-the-geo-supplementary-files-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>This chapter downloads it automatically using <strong>GEOquery</strong>.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="get-data_dataset2.html#cb59-1" tabindex="-1"></a>GSE_ID <span class="ot">&lt;-</span> <span class="st">&quot;GSE240829&quot;</span></span>
<span id="cb59-2"><a href="get-data_dataset2.html#cb59-2" tabindex="-1"></a></span>
<span id="cb59-3"><a href="get-data_dataset2.html#cb59-3" tabindex="-1"></a><span class="co"># Download supplementary files into ./data/GSE240829/</span></span>
<span id="cb59-4"><a href="get-data_dataset2.html#cb59-4" tabindex="-1"></a><span class="co"># (If already downloaded, GEOquery will reuse existing files.)</span></span>
<span id="cb59-5"><a href="get-data_dataset2.html#cb59-5" tabindex="-1"></a></span>
<span id="cb59-6"><a href="get-data_dataset2.html#cb59-6" tabindex="-1"></a><span class="fu">dir.create</span>(<span class="st">&quot;data&quot;</span>, <span class="at">showWarnings =</span> <span class="cn">FALSE</span>)</span>
<span id="cb59-7"><a href="get-data_dataset2.html#cb59-7" tabindex="-1"></a></span>
<span id="cb59-8"><a href="get-data_dataset2.html#cb59-8" tabindex="-1"></a>supp <span class="ot">&lt;-</span> GEOquery<span class="sc">::</span><span class="fu">getGEOSuppFiles</span>(</span>
<span id="cb59-9"><a href="get-data_dataset2.html#cb59-9" tabindex="-1"></a>  GSE_ID,</span>
<span id="cb59-10"><a href="get-data_dataset2.html#cb59-10" tabindex="-1"></a>  <span class="at">makeDirectory =</span> <span class="cn">TRUE</span>,</span>
<span id="cb59-11"><a href="get-data_dataset2.html#cb59-11" tabindex="-1"></a>  <span class="at">baseDir =</span> <span class="st">&quot;data&quot;</span></span>
<span id="cb59-12"><a href="get-data_dataset2.html#cb59-12" tabindex="-1"></a>)</span></code></pre></div>
</div>
<div id="read-the-featurecounts-matrix-1" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> Read the FeatureCounts matrix<a href="get-data_dataset2.html#read-the-featurecounts-matrix-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="get-data_dataset2.html#cb60-1" tabindex="-1"></a>counts_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(<span class="st">&quot;data&quot;</span>, GSE_ID, <span class="st">&quot;GSE240829_POCROC_good.abundance.salmon.genes_8.14.23.txt.gz&quot;</span>)</span>
<span id="cb60-2"><a href="get-data_dataset2.html#cb60-2" tabindex="-1"></a><span class="fu">stopifnot</span>(<span class="fu">file.exists</span>(counts_file))</span>
<span id="cb60-3"><a href="get-data_dataset2.html#cb60-3" tabindex="-1"></a></span>
<span id="cb60-4"><a href="get-data_dataset2.html#cb60-4" tabindex="-1"></a>fc <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_tsv</span>(counts_file, <span class="at">show_col_types =</span> <span class="cn">FALSE</span>)</span>
<span id="cb60-5"><a href="get-data_dataset2.html#cb60-5" tabindex="-1"></a></span>
<span id="cb60-6"><a href="get-data_dataset2.html#cb60-6" tabindex="-1"></a><span class="co"># Peek at the columns</span></span>
<span id="cb60-7"><a href="get-data_dataset2.html#cb60-7" tabindex="-1"></a><span class="fu">names</span>(fc)[<span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">12</span>, <span class="fu">ncol</span>(fc))]</span></code></pre></div>
<pre><code>##  [1] &quot;...1&quot;               &quot;21020_0_ovary&quot;      &quot;21020_2_lymph_node&quot; &quot;24487_0_l_ovary&quot;    &quot;24487_1_lymph_node&quot; &quot;25258_0_l_ovary&quot;   
##  [7] &quot;25258_1_diaphragm&quot;  &quot;29764_0_l_ovary&quot;    &quot;30961_0_r_ovary&quot;    &quot;30961_3_rectum&quot;     &quot;32761_0_l_ovary&quot;    &quot;32761_2_spleen&quot;</code></pre>
<div id="build-a-counts-matrix-genes-samples-1" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Build a counts matrix (genes × samples)<a href="get-data_dataset2.html#build-a-counts-matrix-genes-samples-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="get-data_dataset2.html#cb62-1" tabindex="-1"></a>sample_cols <span class="ot">&lt;-</span> <span class="fu">colnames</span>(fc)</span>
<span id="cb62-2"><a href="get-data_dataset2.html#cb62-2" tabindex="-1"></a></span>
<span id="cb62-3"><a href="get-data_dataset2.html#cb62-3" tabindex="-1"></a>counts <span class="ot">&lt;-</span> fc <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="get-data_dataset2.html#cb62-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="fu">all_of</span>(sample_cols)) <span class="sc">%&gt;%</span></span>
<span id="cb62-5"><a href="get-data_dataset2.html#cb62-5" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb62-6"><a href="get-data_dataset2.html#cb62-6" tabindex="-1"></a></span>
<span id="cb62-7"><a href="get-data_dataset2.html#cb62-7" tabindex="-1"></a><span class="fu">rownames</span>(counts) <span class="ot">&lt;-</span> counts[,<span class="dv">1</span>]</span>
<span id="cb62-8"><a href="get-data_dataset2.html#cb62-8" tabindex="-1"></a>counts[,<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb62-9"><a href="get-data_dataset2.html#cb62-9" tabindex="-1"></a></span>
<span id="cb62-10"><a href="get-data_dataset2.html#cb62-10" tabindex="-1"></a>counts <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(counts)</span>
<span id="cb62-11"><a href="get-data_dataset2.html#cb62-11" tabindex="-1"></a><span class="co">#storage.mode(counts) &lt;- &quot;integer&quot;</span></span>
<span id="cb62-12"><a href="get-data_dataset2.html#cb62-12" tabindex="-1"></a></span>
<span id="cb62-13"><a href="get-data_dataset2.html#cb62-13" tabindex="-1"></a><span class="fu">dim</span>(counts)</span></code></pre></div>
<pre><code>## [1] 33969    43</code></pre>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="get-data_dataset2.html#cb64-1" tabindex="-1"></a>counts[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>##                   21020_0_ovary 21020_2_lymph_node 24487_0_l_ovary
## ENSG00000230092.7     10.718211           4.244121        2.959815
## ENSG00000177757.2      0.018135           0.025687        0.070439
## ENSG00000228794.8      2.335282           2.654898        0.616134</code></pre>
</div>
</div>
<div id="create-metadata-from-sample-names-1" class="section level2 hasAnchor" number="7.3">
<h2><span class="header-section-number">7.3</span> Create metadata from sample names<a href="get-data_dataset2.html#create-metadata-from-sample-names-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Sample names in this series follow patterns like:</p>
<p>21020_0_ovary
21020_2_lymph_node
24487_0_l_ovary
…
Where the first number is the patient id, second number is whether it is primary or recurrent and the third is location. It was separated really badly because there are underscores in the location name as well. (l_ovary = left ovary). –&gt; just grab the last token for the location</p>
<p>We will parse:</p>
<ul>
<li>‘patient’ - patient id</li>
<li>‘status’ - primary, recurrent1, recurrent2, recurrent3</li>
<li>‘location’ - ovary,</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="get-data_dataset2.html#cb66-1" tabindex="-1"></a><span class="co">#design matrix - </span></span>
<span id="cb66-2"><a href="get-data_dataset2.html#cb66-2" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">colnames</span>(counts)[<span class="dv">1</span><span class="sc">:</span><span class="fu">ncol</span>(counts)]</span>
<span id="cb66-3"><a href="get-data_dataset2.html#cb66-3" tabindex="-1"></a>patient  <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(samples,<span class="at">FUN =</span></span>
<span id="cb66-4"><a href="get-data_dataset2.html#cb66-4" tabindex="-1"></a>                             <span class="cf">function</span>(x){<span class="fu">unlist</span>(<span class="fu">strsplit</span>(x,<span class="at">split =</span> <span class="st">&quot;_&quot;</span>))[<span class="dv">1</span>]}))       </span>
<span id="cb66-5"><a href="get-data_dataset2.html#cb66-5" tabindex="-1"></a>status <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(samples,<span class="at">FUN =</span> </span>
<span id="cb66-6"><a href="get-data_dataset2.html#cb66-6" tabindex="-1"></a>                             <span class="cf">function</span>(x){<span class="fu">unlist</span>(<span class="fu">strsplit</span>(x,<span class="at">split =</span> <span class="st">&quot;_&quot;</span>))[<span class="dv">2</span>]}))     </span>
<span id="cb66-7"><a href="get-data_dataset2.html#cb66-7" tabindex="-1"></a>location <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">lapply</span>(samples,<span class="at">FUN =</span> </span>
<span id="cb66-8"><a href="get-data_dataset2.html#cb66-8" tabindex="-1"></a>                             <span class="cf">function</span>(x){</span>
<span id="cb66-9"><a href="get-data_dataset2.html#cb66-9" tabindex="-1"></a>                               <span class="cf">if</span>(<span class="fu">length</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot;_&quot;</span>))) <span class="sc">&gt;</span> <span class="dv">3</span>){</span>
<span id="cb66-10"><a href="get-data_dataset2.html#cb66-10" tabindex="-1"></a>                                 y <span class="ot">&lt;-</span> <span class="fu">paste</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot;_&quot;</span>))[<span class="dv">3</span><span class="sc">:</span><span class="fu">length</span>(<span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot;_&quot;</span>)))],<span class="at">collapse =</span><span class="st">&quot;_&quot;</span>)</span>
<span id="cb66-11"><a href="get-data_dataset2.html#cb66-11" tabindex="-1"></a>                               } <span class="cf">else</span>{</span>
<span id="cb66-12"><a href="get-data_dataset2.html#cb66-12" tabindex="-1"></a>                                 y <span class="ot">&lt;-</span> <span class="fu">unlist</span>(<span class="fu">strsplit</span>(x, <span class="st">&quot;_&quot;</span>))[<span class="dv">3</span>]</span>
<span id="cb66-13"><a href="get-data_dataset2.html#cb66-13" tabindex="-1"></a>                               }</span>
<span id="cb66-14"><a href="get-data_dataset2.html#cb66-14" tabindex="-1"></a>                               <span class="fu">return</span>(y)</span>
<span id="cb66-15"><a href="get-data_dataset2.html#cb66-15" tabindex="-1"></a>                               }))  </span>
<span id="cb66-16"><a href="get-data_dataset2.html#cb66-16" tabindex="-1"></a>meta <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(samples, patient,status, location)</span></code></pre></div>
</div>
<div id="identifier-mapping-1" class="section level2 hasAnchor" number="7.4">
<h2><span class="header-section-number">7.4</span> Identifier mapping<a href="get-data_dataset2.html#identifier-mapping-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="get-data_dataset2.html#cb67-1" tabindex="-1"></a>strip_ensembl_version <span class="ot">&lt;-</span> <span class="cf">function</span>(x) <span class="fu">sub</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">..*$&quot;</span>, <span class="st">&quot;&quot;</span>, x)</span>
<span id="cb67-2"><a href="get-data_dataset2.html#cb67-2" tabindex="-1"></a></span>
<span id="cb67-3"><a href="get-data_dataset2.html#cb67-3" tabindex="-1"></a>kable_head <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">caption =</span> <span class="cn">NULL</span>) {</span>
<span id="cb67-4"><a href="get-data_dataset2.html#cb67-4" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(utils<span class="sc">::</span><span class="fu">head</span>(x, n), <span class="at">caption =</span> caption)</span>
<span id="cb67-5"><a href="get-data_dataset2.html#cb67-5" tabindex="-1"></a>}</span>
<span id="cb67-6"><a href="get-data_dataset2.html#cb67-6" tabindex="-1"></a></span>
<span id="cb67-7"><a href="get-data_dataset2.html#cb67-7" tabindex="-1"></a>mapped_counts <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">ensembl_gene_id =</span> <span class="fu">strip_ensembl_version</span>(<span class="fu">rownames</span>(counts)),counts)</span>
<span id="cb67-8"><a href="get-data_dataset2.html#cb67-8" tabindex="-1"></a>ids<span class="ot">&lt;-</span> mapped_counts<span class="sc">$</span>ensembl_gene_id</span>
<span id="cb67-9"><a href="get-data_dataset2.html#cb67-9" tabindex="-1"></a></span>
<span id="cb67-10"><a href="get-data_dataset2.html#cb67-10" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">any</span>(<span class="fu">grepl</span>(<span class="st">&quot;^ENSG&quot;</span>, <span class="fu">strip_ensembl_version</span>(ids)))) {</span>
<span id="cb67-11"><a href="get-data_dataset2.html#cb67-11" tabindex="-1"></a>  <span class="fu">library</span>(biomaRt)</span>
<span id="cb67-12"><a href="get-data_dataset2.html#cb67-12" tabindex="-1"></a>  ensembl_ids <span class="ot">&lt;-</span> <span class="fu">unique</span>(<span class="fu">strip_ensembl_version</span>(ids))</span>
<span id="cb67-13"><a href="get-data_dataset2.html#cb67-13" tabindex="-1"></a>  ensembl <span class="ot">&lt;-</span> <span class="fu">useMart</span>(<span class="st">&quot;ensembl&quot;</span>, <span class="at">dataset =</span> <span class="st">&quot;hsapiens_gene_ensembl&quot;</span>)</span>
<span id="cb67-14"><a href="get-data_dataset2.html#cb67-14" tabindex="-1"></a></span>
<span id="cb67-15"><a href="get-data_dataset2.html#cb67-15" tabindex="-1"></a>  map <span class="ot">&lt;-</span> <span class="fu">getBM</span>(</span>
<span id="cb67-16"><a href="get-data_dataset2.html#cb67-16" tabindex="-1"></a>    <span class="at">attributes =</span> <span class="fu">c</span>(<span class="st">&quot;ensembl_gene_id&quot;</span>, <span class="st">&quot;hgnc_symbol&quot;</span>),</span>
<span id="cb67-17"><a href="get-data_dataset2.html#cb67-17" tabindex="-1"></a>    <span class="at">filters =</span> <span class="st">&quot;ensembl_gene_id&quot;</span>,</span>
<span id="cb67-18"><a href="get-data_dataset2.html#cb67-18" tabindex="-1"></a>    <span class="at">values =</span> ensembl_ids,</span>
<span id="cb67-19"><a href="get-data_dataset2.html#cb67-19" tabindex="-1"></a>    <span class="at">mart =</span> ensembl</span>
<span id="cb67-20"><a href="get-data_dataset2.html#cb67-20" tabindex="-1"></a>  )</span>
<span id="cb67-21"><a href="get-data_dataset2.html#cb67-21" tabindex="-1"></a></span>
<span id="cb67-22"><a href="get-data_dataset2.html#cb67-22" tabindex="-1"></a>  <span class="fu">kable_head</span>(map, <span class="dv">10</span>, <span class="fu">paste</span>(<span class="st">&quot;: mapping preview&quot;</span>))</span>
<span id="cb67-23"><a href="get-data_dataset2.html#cb67-23" tabindex="-1"></a></span>
<span id="cb67-24"><a href="get-data_dataset2.html#cb67-24" tabindex="-1"></a>counts_mapped <span class="ot">&lt;-</span> mapped_counts <span class="sc">%&gt;%</span></span>
<span id="cb67-25"><a href="get-data_dataset2.html#cb67-25" tabindex="-1"></a>    <span class="fu">left_join</span>(map, <span class="at">by =</span> <span class="st">&quot;ensembl_gene_id&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb67-26"><a href="get-data_dataset2.html#cb67-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( ensembl_gene_id,hgnc_symbol, <span class="fu">everything</span>())</span>
<span id="cb67-27"><a href="get-data_dataset2.html#cb67-27" tabindex="-1"></a></span>
<span id="cb67-28"><a href="get-data_dataset2.html#cb67-28" tabindex="-1"></a></span>
<span id="cb67-29"><a href="get-data_dataset2.html#cb67-29" tabindex="-1"></a>  <span class="fu">kable_head</span>(counts_mapped[, <span class="dv">1</span><span class="sc">:</span><span class="fu">min</span>(<span class="dv">8</span>, <span class="fu">ncol</span>(counts_mapped))], <span class="dv">5</span>, <span class="fu">paste</span>(<span class="st">&quot;: mapped table preview&quot;</span>))</span>
<span id="cb67-30"><a href="get-data_dataset2.html#cb67-30" tabindex="-1"></a>}</span></code></pre></div>
<table>
<caption><span id="tab:unnamed-chunk-37">Table 7.1: </span>: mapped table preview</caption>
<colgroup>
<col width="11%" />
<col width="8%" />
<col width="11%" />
<col width="14%" />
<col width="12%" />
<col width="14%" />
<col width="12%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">ensembl_gene_id</th>
<th align="left">hgnc_symbol</th>
<th align="right">X21020_0_ovary</th>
<th align="right">X21020_2_lymph_node</th>
<th align="right">X24487_0_l_ovary</th>
<th align="right">X24487_1_lymph_node</th>
<th align="right">X25258_0_l_ovary</th>
<th align="right">X25258_1_diaphragm</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">ENSG00000230092</td>
<td align="left"></td>
<td align="right">10.718211</td>
<td align="right">4.244121</td>
<td align="right">2.959815</td>
<td align="right">1.920198</td>
<td align="right">1.591502</td>
<td align="right">0.695518</td>
</tr>
<tr class="even">
<td align="left">ENSG00000177757</td>
<td align="left">FAM87B</td>
<td align="right">0.018135</td>
<td align="right">0.025687</td>
<td align="right">0.070439</td>
<td align="right">0.031852</td>
<td align="right">0.005534</td>
<td align="right">0.000000</td>
</tr>
<tr class="odd">
<td align="left">ENSG00000228794</td>
<td align="left">LINC01128</td>
<td align="right">2.335282</td>
<td align="right">2.654898</td>
<td align="right">0.616134</td>
<td align="right">0.635164</td>
<td align="right">0.477670</td>
<td align="right">0.851483</td>
</tr>
<tr class="even">
<td align="left">ENSG00000225880</td>
<td align="left">LINC00115</td>
<td align="right">0.425905</td>
<td align="right">0.396866</td>
<td align="right">0.313534</td>
<td align="right">0.296781</td>
<td align="right">0.125387</td>
<td align="right">0.249801</td>
</tr>
<tr class="odd">
<td align="left">ENSG00000230368</td>
<td align="left">FAM41C</td>
<td align="right">0.230066</td>
<td align="right">0.409599</td>
<td align="right">0.420536</td>
<td align="right">0.126110</td>
<td align="right">0.165970</td>
<td align="right">0.029084</td>
</tr>
</tbody>
</table>
</div>
<div id="save-intermediate-objects-1" class="section level2 hasAnchor" number="7.5">
<h2><span class="header-section-number">7.5</span> Save intermediate objects<a href="get-data_dataset2.html#save-intermediate-objects-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="get-data_dataset2.html#cb68-1" tabindex="-1"></a><span class="fu">saveRDS</span>(<span class="fu">list</span>(<span class="at">counts =</span> counts, </span>
<span id="cb68-2"><a href="get-data_dataset2.html#cb68-2" tabindex="-1"></a>             <span class="at">meta =</span> meta, </span>
<span id="cb68-3"><a href="get-data_dataset2.html#cb68-3" tabindex="-1"></a>             <span class="at">mappings =</span> counts_mapped[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]), <span class="at">file =</span> <span class="st">&quot;data/d2_counts_and_meta.rds&quot;</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="deseq2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="qc_dataset2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["DE_tutorial.pdf", "DE_tutorial.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "section"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
